version: "3"
services:
    prometheus:
        image: prom/prometheus:v2.30.3
        container_name: prometheus
        volumes:
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
        command:
            - '--config.file=/etc/prometheus/prometheus.yml'
        networks:
            - prometheus
            - node_exporter
        ports:
            - 9090:9090


    node_exporter:
        image: carlosedp/node_exporter
        container_name: node_exporter
        networks:
            - node_exporter
        ports:
          - 9100:9100

    grafana:
        image: grafana/grafana
        container_name: grafana
        ports:
          - 3000:3000
        depends_on:
            - prometheus
        networks:
            - prometheus
        environment:
            - GF_SERVER_ROOT_URL=http://localhost:3000
            - GF_SECURITY_ADMIN_USER=admin
            - GF_SECURITY_ADMIN_PASSWORD=admin
        volumes:
            - grafana:/var/lib/grafana

volumes:
    grafana:
        driver: local
        driver_opts:
          o: bind
          type: none
          device: ./grafana


networks:
    prometheus:
    node_exporter:
    
